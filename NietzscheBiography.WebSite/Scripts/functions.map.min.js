String.prototype.format=function(){a=this;for(k in arguments)a=a.replace("{"+k+"}",arguments[k]);return a};$("body").on("hidden",".modal",function(){$(this).removeData("modal")});$(function(){var t=$("#map_canvas").attr("data-participant-id"),n=$("#event-type option:selected").attr("value"),i="47,7",r=4;parseInt(n)>0&&(i="47,-45",r=3),$("#map_canvas").gmap({center:i,zoom:r,disableDefaultUI:!0}).bind("init",function(){$("#map_canvas").gmap("addControl","radios",google.maps.ControlPosition.TOP_LEFT);var i="/timeline/data";i+="?participantId="+t+"&format=html",n&&(i+="&typeId="+n),$.ajaxSetup({async:!1}),$.getJSON("/places/data",{participantId:t,eventTypeId:n}).done(function(n){$.each(n.locations,function(n,t){var r=[];$.each(t.events,function(n,t){jQuery.inArray(t.event_type,r)==-1&&r.push(t.event_type)}),$("#map_canvas").gmap("addMarker",{tags:r,bound:!0,position:new google.maps.LatLng(parseFloat(t.latitude),parseFloat(t.longitude))}).click(function(){var n='<a href="/place-'+t.location_id+'">';n+=t.title+"<\/a><br />",n+='<a class="btn btn-small" data-toggle="modal" ',n+='href="'+i+"&locationId="+t.location_id+'" ',n+='data-target="#location-events-modal"><i class="icon-list-alt"><\/i> See Events<\/a>',$("#map_canvas").gmap("openInfoWindow",{content:n},this)})});var t=0;$.each(n.event_type_occurrences,function(n,i){t>=10||($("#radios fieldset").append('<label class="checkbox"><input type="checkbox" value="{0}" />{1}<\/label>'.format(n,n+" ("+i+")")),t++)})}),$("input:checkbox").click(function(){$("#map_canvas").gmap("closeInfoWindow"),$("#map_canvas").gmap("set","bounds",null);var n=[];$("input:checkbox:checked").each(function(t,i){n.push($(i).val())}),n.length>0?$("#map_canvas").gmap("find","markers",{property:"tags",value:n,operator:"OR"},function(n,t){t&&$("#map_canvas").gmap("addBounds",n.position),n.setVisible(t)}):$.each($("#map_canvas").gmap("get","markers"),function(n,t){$("#map_canvas").gmap("addBounds",t.position),t.setVisible(!0)})})})});