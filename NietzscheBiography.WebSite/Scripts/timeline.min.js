function Timeline(n,t){var i=this,r=$(document.body);this._lightbox=this._overlay=this._column_center=this._column_right=this._column_left=this._spine=this._container=null,this._data=t,this._options={animation:!0,lightbox:!0,showYear:!0,columnMode:"dual",allowDelete:!1,order:"desc"},this._years=[],this._readmore_text="Read More",this._max_element_width=0,this._spint_margin=100,this._elements=[],this._separators=[],this._gallery_queue=[],this._iframe_queue=[],this._use_css3=function(){var i=document.body.style,t,n;if("string"==typeof i.transition)return!0;for(t=["Webkit","Moz","Khtml","O","ms"],n=0;n<t.length;n++)if("string"==typeof i[t[n]+"Transition"])return!0;return!1}(),this._default_element_data={type:"blog_post",date:"2000-01-01",width:400,title:null,content:null,image:null,readmore:null,height:300,images:[],speed:5e3,url:null},this._createElement=function(n,t){var r,u,f;n=$.extend({},i._default_element_data,n),r=$("<div>").addClass("timeline_element "+n.type).width(n.width),i._options.animation||r.addClass("animated"),null!==n.title?$("<div>").addClass("title").html('<span class="label">'+n.title+"<\/span>").appendTo(r):r.addClass("notitle");switch(n.type){case"iframe":u=$("<div>").addClass("content loading").height(n.height).appendTo(r),i._iframe_queue.push({element:u,url:n.url});break;case"blog_post":null!==n.image&&(u=$("<div>").addClass("img_container").append($("<img>").attr("src",n.image)).appendTo(r),i._options.lightbox&&u.append($("<div>").addClass("img_overlay").html('<span class="magnifier" data-type="blog_post" data-img="'+n.image+'"><\/span>'))),null!==n.content&&$("<div>").addClass("content").html(n.content).appendTo(r),null!==n.readmore&&$("<div>").addClass("readmore").html('<a href="'+n.readmore+'">'+i._readmore_text+"<\/a>").appendTo(r);break;case"gallery":if(n.images.length){var u=$("<div>").addClass("scroll_container").appendTo(r),o=$("<div>").addClass("scroller").height(n).appendTo(u).bind("gallery_onload",i._galleryOnLoad),e="",s=0,h=n.images.length;$(n.images).each(function(t,r){e+='<div class="img_container"><img height="'+n.height+'" src="'+r+'" />',i._options.lightbox&&(e+='<div class="img_overlay"><span class="magnifier" data-total="'+n.images.length+'" data-order="'+t+'" data-type="gallery" data-img="'+r+'"><\/span><\/div>'),e+="<\/div>";var f=function(){s++,s===h&&o.trigger("gallery_onload")},u=new Image;u.onload=f,u.onerror=f,u.src=r}),o.html('<div class="ruler">'+e+"<\/div>")}break;case"slider":f="",$(n.images).each(function(t,r){f+='<div data-total="'+n.images.length+'" data-order="'+t+'" class="img_container'+(0===t?" active":"")+'" style="display:'+(0===t?"block":"none")+';"><img src="'+r+'" />',i._options.lightbox&&(f+='<div class="img_overlay"><span class="magnifier" data-total="'+n.images.length+'" data-order="'+t+'" data-type="slider" data-img="'+r+'"><\/span><\/div>'),f+="<\/div>"}),1<n.images.length&&(f+='<span class="slider_prev"><\/span><span class="slider_next"><\/span>'),$("<div>").addClass("content").width(n.width).height(n.height).html(f).appendTo(r),1<n.images.length&&(r.data("speed",n.speed),setTimeout(function(){i._updateSlider(r,"next")},n.speed))}return i._options.allowDelete&&$("<div>").addClass("del").data("timeline_element",r).text("Delete").appendTo(r),r.appendTo(t),i._max_element_width=Math.max(i._max_element_width,n.width),i._elements.push(r),r},this._deleteElement=function(n){var t=n.parent();n.remove(),t.children(".timeline_element").length||t.remove()},this._updateSlider=function(n,t){if(n.data("timeout_id")&&clearTimeout(n.data("timeout_id")),!i._overlay.hasClass("open")){var r=n.find(".img_container.active").removeClass("active"),u="next"===t?r.data("order")===r.data("total")-1?n.find(".img_container:first").addClass("active"):r.next().addClass("active"):0===r.data("order")?n.find(".img_container:last").addClass("active"):r.prev().addClass("active");r.fadeOut(),u.fadeIn()}r=setTimeout(function(){i._updateSlider(n,t)},n.data("speed")),n.data("timeout_id",r)},this._startAnimation=function(n){return $(window).width(),i._use_css3?i._spine.addClass("animated"):i._spine.animate({bottom:"0%"},500,function(){i._spine.addClass("animated")}),i._options.showYear&&setTimeout(function(){$(i._separators).each(function(n,t){i._use_css3?t.addClass("animated"):t.children("span").animate({opacity:1,top:"50%"},300,function(){t.addClass("animated")})})},500),$(i._elements).each(function(t,r){setTimeout(function(){i._use_css3?r.addClass("animated"):r.hide().addClass("animated").fadeIn(),t===i._elements.length-1&&setTimeout(n,200)},(i._options.showYear?1e3:500)+100*t)}),!0},this._getDateString=function(n){return n=n.split("-"),n[2]+" "+" January February March April May June July August September October November December".split(" ")[parseInt(n[1],10)]+" "+n[0]},this._setGalleryWidth=function(n){!0!==n.data("loaded")&&(n.parent().addClass("loaded"),n.data("loaded",!0).width(n.children("div.ruler").width()))},this._openLightBox=function(n,t){return n.parent().addClass("loading"),"gallery"===n.data("type")||"slider"===n.data("type")?(i._lightbox.children("span").show(),i._lightbox.data("magnifier",n),i._toggleLightBoxControl(parseInt(n.data("total"),10),parseInt(n.data("order"),10))):i._lightbox.children("span").hide(),setTimeout(function(){var r=new Image;r.onload=function(){n.parent().removeClass("loading"),i._overlay.addClass("open"),$("<img>").attr("src",t).appendTo(i._lightbox);var u=i._getLightboxSize(r.width,r.height),u={width:u.width,height:u.height,margin:"-"+u.height/2+"px 0px 0px -"+u.width/2+"px"};i._use_css3?i._lightbox.addClass("loaded").css(u):i._lightbox.css(u).animate({top:"50%",opacity:1},300,function(){i._lightbox.addClass("loaded")})},r.src=t},1e3),t},this._closeLightBox=function(){i._use_css3?i._lightbox.removeClass("loaded"):i._lightbox.animate({top:0,opacity:0},300,function(){i._lightbox.removeClass("loaded")}),setTimeout(function(){i._overlay.removeClass("open"),i._lightbox.removeAttr("style").children("img").remove()},300)},this._getLightboxSize=function(n,t){var f=.9*$(window).width(),u=.9*$(window).height(),r=n,i=t;return(n>f||t>u)&&(n>f&&t<=u?(r=f,i=t/(n/r)):t>u&&n<=f?(i=u,r=n/(t/i)):(r=f,i=t/(n/r),i>u&&(i=u,r=n/(t/i)))),{width:r,height:i}},this._navLightBox=function(n,t){var r="next"===t?i._lightbox.data("magnifier").parents(".img_container:first").next().find("span.magnifier"):i._lightbox.data("magnifier").parents(".img_container:first").prev().find("span.magnifier"),f=r.data("img"),u=new Image;u.onload=function(){i._lightbox.data("magnifier",r).addClass("updating"),i._lightbox.children("img").attr("src",f);var n=i._getLightboxSize(u.width,u.height),n={width:n.width,height:n.height,margin:"-"+n.height/2+"px 0px 0px -"+n.width/2+"px"};i._use_css3?i._lightbox.css(n):i._lightbox.animate(n,500),i._toggleLightBoxControl(parseInt(r.data("total"),10),parseInt(r.data("order"),10)),setTimeout(function(){i._lightbox.removeClass("updating")},500)},u.src=f},this._toggleLightBoxControl=function(n,t){1>=n?i._lightbox.children("span").hide():(0===t?i._lightbox.children("span.prev").hide():i._lightbox.children("span.prev").show(),t===n-1?i._lightbox.children("span.next").hide():i._lightbox.children("span.next").show())},this._processGalleryOnloadQueue=function(){$(i._gallery_queue).each(function(n,t){i._setGalleryWidth(t)}),i._gallery_queue=[]},this._processIframeQueue=function(){$(i._iframe_queue).each(function(n,t){t.element.removeClass("loading").html('<iframe frameborder="0" src="'+t.url+'"><\/iframe>')})},this._galleryOnLoad=function(){var n=$(this);return!0===i._container.data("loaded")?i._setGalleryWidth(n):i._gallery_queue.push(n),!0},this._handleClick=function(n){var t=$(n.target);return t.hasClass("timeline_overlay")?i._closeLightBox(n):t.hasClass("magnifier")?i._openLightBox(t,t.data("img")):t.hasClass("prev")?i._navLightBox(t,"prev"):t.hasClass("next")?i._navLightBox(t,"next"):t.hasClass("slider_prev")?i._updateSlider(t.parents(".timeline_element:first"),"prev"):t.hasClass("slider_next")?i._updateSlider(t.parents(".timeline_element:first"),"next"):t.hasClass("del")&&i._deleteElement(t.data("timeline_element")),!0},this._handleKeyDown=function(n){switch(parseInt(n.which,10)){case 27:i._overlay.hasClass("open")&&i._closeLightBox(n);break;case 37:if(i._lightbox.hasClass("loaded")&&i._lightbox.children("span.prev").is(":visible"))return i._lightbox.children("span.prev").click(),!1;break;case 39:if(i._lightbox.hasClass("loaded")&&i._lightbox.children("span.next").is(":visible"))return i._lightbox.children("span.next").click(),!1}},this.setOptions=function(n){return i._options=$.extend(i._options,n),i._options},this.display=function(){return!0!==$(document).data("timeline_events_binded")&&$(document).data("timeline_events_binded",!0).click(i._handleClick).keydown(i._handleKeyDown),i._data.sort(function(n,t){return"desc"===i._options.order?parseInt(t.date.replace(/-/g,""),10)-parseInt(n.date.replace(/-/g,""),10):parseInt(n.date.replace(/-/g,""),10)-parseInt(t.date.replace(/-/g,""),10)}),i._options.lightbox&&(i._overlay=$(".timeline_overlay"),i._overlay.length?i._lightbox=i._overlay.children(".lightbox"):(i._overlay=$("<div>").addClass("timeline_overlay"),i._lightbox=$("<div>").addClass("lightbox").html('<span class="prev"><\/span><span class="next"><\/span>').appendTo(i._overlay),i._overlay.appendTo(r))),i._container=$("<div>").addClass("timeline "+i._options.columnMode),$.support.opacity||i._container.addClass("opacityFilter"),i._use_css3||i._container.addClass("noneCSS3"),i._spine=$("<div>").addClass("spine").appendTo(i._container),i._options.animation||i._spine.addClass("animated"),$(i._data).each(function(n,t){var r=t.date.split("-")[0],u;-1===$.inArray(r,i._years)&&(i._years.push(r),i._options.showYear&&1<i._years.length&&(u=$("<div>").addClass("date_separator").html("<span>"+r+"<\/span>").appendTo(i._container),i._options.animation||u.addClass(animated),i._separators.push(u)),(i._options.showYear||0===n)&&("dual"===i._options.columnMode?(i._column_left=$("<div>").addClass("column column_left year_"+r).appendTo(i._container),i._column_right=$("<div>").addClass("column column_right year_"+r).appendTo(i._container)):"left"===i._options.columnMode?i._column_left=$("<div>").addClass("column column_left year_"+r).appendTo(i._container):"right"===i._options.columnMode?i._column_right=$("<div>").addClass("column column_right year_"+r).appendTo(i._container):"center"===i._options.columnMode&&(i._column_center=$("<div>").addClass("column column_center year_"+r).appendTo(i._container)))),"dual"===i._options.columnMode?i._createElement(t,0==n%2?i._column_left:i._column_right):"left"===i._options.columnMode?i._createElement(t,i._column_left):"right"===i._options.columnMode?i._createElement(t,i._column_right):"center"===i._options.columnMode&&i._createElement(t,i._column_center)}),i._max_element_width&&("dual"===i._options.columnMode?i._container.width(2*i._max_element_width+i._spint_margin):i._container.width(i._max_element_width+i._spint_margin)),i._container.data("loaded",!0).appendTo(n),i._processGalleryOnloadQueue(),i._options.animation?setTimeout(function(){i._startAnimation(i._processIframeQueue)},200):i._processIframeQueue(),!0}}