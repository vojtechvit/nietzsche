function validateDates(){var n=$("#timeline-start-year option:selected").attr("value"),t=$("#timeline-end-year option:selected").attr("value");n>0&&t>0&&n>t&&$("#timeline-end-year").val(n)}function displayTimeline(){var n;$("#timeline").html("");var i=$("#timeline").attr("data-participant-id"),r=$("#event-type option:selected").attr("value"),u=$("#event-importance option:selected").attr("value"),f=$("#timeline-start-year option:selected").attr("value"),e=$("#timeline-end-year option:selected").attr("value"),t=[];$.ajaxSetup({async:!1}),$.getJSON("/timeline/data",{participantId:i,typeId:r,importance:u,startYear:f,endYear:e}).done(function(n){$.each(n,function(n,i){if(i.start_date!==null){var r={type:"blog_post",date:i.StartDate,title:i.Occurrence,width:400,content:i.Title+"<br />"+getEventCitations(i.Citations)};t.push(r)}})}),options={animation:!0,lightbox:!1,showYear:!1,allowDelete:!1,columnMode:"dual",order:"asc"},n=new Timeline($("#timeline"),t),n.setOptions(options),n.display(),$(".event-citation").popover({placement:"bottom",trigger:"hover"})}function getEventCitations(n){var t=[],i="";return n!==undefined&&$.each(n,function(n,i){if(i.Text!==null&&i.Text.length){var r='<small class="event-citation" ';r+='data-toggle="popover" data-placement="top" ',r+='data-content="'+i.Text+'" title="" ',r+='data-original-title="'+i.Title+'">',r+=i.SourceTitle+"<\/small>",t.push(r)}else i.SourceTitle!==null&&i.SourceTitle.length&&t.push('<small class="muted">'+i.SourceTitle+"<\/small>")}),t.length&&(i='<p class="text-center event-citation-source">',i+=t.join("<br />"),i+="<\/p>"),i}$(document).ready(function(){displayTimeline(),$("#timeline-filter-bar select").change(function(){validateDates(),displayTimeline()})});